
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Conjunt de proves realitzades &mdash; Incorporació de transformacions de malla NTv2 a Geotools i a Geoserver 1 documentation</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Incorporació de transformacions de malla NTv2 a Geotools i a Geoserver 1 documentation" href="index.html" />
    <link rel="next" title="Guia ràpida de configuració a GeoServer" href="use.html" />
    <link rel="prev" title="Desenvolupament a GeoServer" href="geoserver.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related">
      <h3>Navegació</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="use.html" title="Guia ràpida de configuració a GeoServer"
             accesskey="N">següent</a></li>
        <li class="right" >
          <a href="geoserver.html" title="Desenvolupament a GeoServer"
             accesskey="P">anterior</a> |</li>
        <li><a href="index.html">Incorporació de transformacions de malla NTv2 a Geotools i a Geoserver 1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="conjunt-de-proves-realitzades">
<h1>Conjunt de proves realitzades<a class="headerlink" href="#conjunt-de-proves-realitzades" title="Link permanent a aquest títol">¶</a></h1>
<p>S&#8217;han realitzat proves per verificar el comportament del codi des de diferents punts de vista.</p>
<p>En primer lloc, tot el codi aportat a GeoTools i a GeoServer ha d&#8217;anar acompanyat d&#8217;un conjunt de tests unitaris realitzats amb <a class="reference external" href="http://www.junit.org/">JUnit</a> que tinguin una cobertura suficientment significativa, però que alhora siguin d&#8217;un temps d&#8217;execució suficientment acotat que permetin executar-los amb assiduitat junt amb la resta de tests unitaris del projecte (per exemple, en els diversos serveis d&#8217;integració contínua de que disposa la comunitat de desenvolupadors). Aquests tests unitaris, doncs, formen part del codi font de l&#8217;aplicació, i es troben als repositoris de codi oficials dels projectes.</p>
<p>La resta de proves realitzades amb GeoTools són més específiques per al cas d&#8217;ús de l&#8217;ICC: Tests de rendiment i de precisió, comparant el temps invertit i l&#8217;error associat a les diferents alternatives de transformació (7 paràmetres, malla ICC, malla IGN, i semblança). Per a aquestes proves de rendiment i precisió s&#8217;ha desenvolupat una petita aplicació basada en GeoTools, que es pot descarregar, junt amb el codi font d&#8217;aquest document, a:</p>
<blockquote>
<div><a class="reference external" href="https://github.com/oscarfonts/gt-datumshift">https://github.com/oscarfonts/gt-datumshift</a></div></blockquote>
<p>Aquesta aplicació està basada en <a class="reference external" href="http://maven.apache.org/">maven</a>, el que permet gestionar-ne les dependències, generar el projecte per a la seva càrrega a <a class="reference external" href="http://www.eclipse.org/">eclipse</a>, o executar les proves des de la línia de comandes.</p>
<p>Per últim, s&#8217;ha desenvolupat una aplicació web basada en <a class="reference external" href="http://openlayers.org/">OpenLayers</a> que fa ús dels serveis WMS de GeoServer i els integra amb serveis WMS externs, per comprovar que la funcionalitat final és l&#8217;esperada, i que s&#8217;integra bé amb altres serveis i aplicacions.</p>
<div class="section" id="tests-unitaris">
<h2>Tests unitaris<a class="headerlink" href="#tests-unitaris" title="Link permanent a aquest títol">¶</a></h2>
<p>Desenvolupats en <cite>jUnit</cite>, formen part del codi font dels projectes. S&#8217;han incorporat els següents tests:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="_images/unit-tests.PNG"><img alt="_images/unit-tests.PNG" src="_images/unit-tests.PNG" /></a>
<p class="caption">Classes encarregades dels tests unitaris.</p>
</div>
<ul class="simple">
<li><cite>SimilarityTransformProviderTest</cite>: Comprova que, donats un conjunt de paràmetres vàlids per a una transformació de tipus <cite>EPSG:9621</cite>, la factoria de transformacions matemàtiques utilitzarà <cite>SimilarityTransformProvider</cite> per crear la transformació. També realitza la transformació d&#8217;un punt conegut per comprovar que l&#8217;operació matemàtica resultant es realitza correctament.</li>
<li><cite>NTv2TransformTest</cite>: Comprova tots els mètodes públics de <cite>NTv2Transform</cite>: Dimensions, valors de paràmetres, operació inversa, etc. Utilitza una malla d&#8217;exemple per transformar un punt conegut i comprovar la seva validesa.</li>
<li><cite>NTv2GridShiftFactoryTest</cite>: Comprova la càrrega d&#8217;un fitxer de malla en memòria. Comprova també la gestió correcta de situacions excepcionals: Fitxer de malla inexistent, fitxer de malla amb format erroni.</li>
<li><cite>TestGridShiftLocator</cite>: Comprova que és capaç de localitzar correctament un fitxer de malla com a un recurs extern.</li>
<li><cite>CoordinateOperationFactoryUsingWKTTest</cite>: Comprova que la classe és capaç de proveïr operacions a partir de les definicions en un fitxer de propietats. Comprova també que és capaç de recuperar el fitxer de propietats a diferents localitzacions, segons l&#8217;especificat al <cite>javadoc</cite> de la classe sotmesa a proves (veure <tt class="docutils literal"><span class="pre">CoordinateOperationFactoryUsingWKT</span></tt> a l&#8217;apartat <cite>Javadoc</cite>).</li>
</ul>
</div>
<div class="section" id="tests-de-rendiment">
<h2>Tests de rendiment<a class="headerlink" href="#tests-de-rendiment" title="Link permanent a aquest títol">¶</a></h2>
<p>Per efectuar els tests de rendiment, s&#8217;ha descarregat de <a class="reference external" href="http://www.icc.cat/vissir3/">Vissir 3</a> un full de la Base Topogràfica 1:5 000, en concret el 289-126, situat aproximadament al centre de Barcelona. S&#8217;ha descarregat en format Shapefile, datum ED50. De les capes que formen aquesta base, s&#8217;ha escollit la capa més complexa, una capa amb 2.189 geometries linials i un pes (només fitxer <cite>.shp</cite>) d&#8217;aproximadament 1 Mb.</p>
<p>S&#8217;han comparat els temps de conversió d&#8217;aquesta capa des del CRS original, <cite>EPSG:23031</cite>, al CRS <cite>EPSG:25831</cite>, utilitzant els següents mètodes de transformació:</p>
<ul class="simple">
<li><strong>Identitat</strong>: Una transformació afí amb la matriu identitat.</li>
<li><strong>Semblança</strong>: La transformació bidimensional de semblança oficial de l&#8217;ICC, <cite>EPSG:5166</cite>.</li>
<li><strong>Malla NTv2</strong>: La transformació de malla NTv2 oficial de l&#8217;ICC, <cite>100800401.gsb</cite></li>
<li><strong>7 paràmetres</strong>: La transformació de 7 paràmetres escollida per GeoServer abans d&#8217;aquest desenvolupament.</li>
</ul>
<p>El temps de conversió utilitzant un mateix mètode pot variar notablement entre execucions consecutives. Executant la conversió repetidament, s&#8217;observa que el temps de conversió disminueix a cada iteració, fins que arriba a un règim estacionari en que, tot i haver-hi certa variabilitat, els resultats són repetibles. Aquest comportament transitori inicial es deu a la pròpia gestió de recursos i de <em>caché</em> del sistema operatiu i de la màquina virtual, que no és objecte d&#8217;aquesta anàlisi.</p>
<p>Per tant, cada un dels mètodes s&#8217;ha executat 35 vegades, descartant les 10 primeres iteracions per arribar al règim estacionari, i calculant la mitjana i desviació estàndard del temps de conversió per a les 25 iteracions següents. Els resultats són:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="26%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mètode</th>
<th class="head">temps mitjà</th>
<th class="head">desviació estàndard</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Identitat</td>
<td>12 ms</td>
<td>2.3 ms</td>
</tr>
<tr class="row-odd"><td>Semblança</td>
<td>13 ms</td>
<td>2.8 ms</td>
</tr>
<tr class="row-even"><td>Malla NTv2</td>
<td>32 ms</td>
<td>2.1 ms</td>
</tr>
<tr class="row-odd"><td>7 paràmetres</td>
<td>48 ms</td>
<td>9.6 ms</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Cal tenir en compte que el temps de conversió depèn en gran mesura de l&#8217;entorn d&#8217;execució. Per tant, aquests temps no es poden prendre com a valors absoluts, sinó només a efectes comparatius entre els diferents mètodes.</p>
<div class="figure align-center">
<img alt="_images/temps.png" src="_images/temps.png" />
<p class="caption">Temps de conversió mitjà (i desviació estàndard) entre diferents mètodes de transformació.</p>
</div>
<p>La transformació d&#8217;identitat no és immediata, perque dins del període mesurat també s&#8217;hi inclou el procés d&#8217;iterar sobre cada geometria, obrir-la, descomposar-la, i generar-ne una de nova, encara que sigui una còpia idèntica.</p>
<p>Observem que el temps invertit en una transformació de semblança és similar a aplicar la identitat. Per tant, el temps invertit en el càlcul en sí no és significatiu davant de les altres tasques associades a la transformació.</p>
<p>La transformació de malla NTv2 requereix una conversió de UTM a coordenades geodèsiques, l&#8217;aplicació de la malla, i una conversió inversa de geodèsiques a UTM. El cost d&#8217;aquest procés de transformació ja és notable, pel que per motius de rendiment és aconsellable utilitzar la transformació de semblança quan sigui possible (en la conversió directa de UTM a UTM).</p>
<p>Per últim, la transformació de 7 paràmetres, que obliga a passar a coordenades geocèntriques, és el procés més costós de tots. Aquí es poden veure els beneficis de la gestió avançada de la malla NTv2 en memòria, descrita en apartats anteriors, que minimitza els accessos a disc i per tant la fa més eficient.</p>
</div>
<div class="section" id="tests-de-precisio">
<h2>Tests de precisió<a class="headerlink" href="#tests-de-precisio" title="Link permanent a aquest títol">¶</a></h2>
<p>Quant a les proves de precisió, s&#8217;ha utilitzat el mateix full 1:5 000 (289-126). Aquest cop s&#8217;ha descarregat el full en els dos datums, ED50 i ETRS89. El procés ha consistit a convertir la capa d&#8217;ED50 a ETRS89 amb diferents mètodes, i, prenent com a referència la capa ETRS89 descarregada de l&#8217;ICC, calcular la distància punt a punt.</p>
<p>Per simplificar la comparació, s&#8217;ha escollit una capa de tipus punt. Entre les disponibles, s&#8217;ha escollit la que conté més elements (cotes), que compta amb 959 geometries puntuals.</p>
<p>Els mètodes utilitzats han estat:</p>
<ul class="simple">
<li><strong>Semblança</strong>: La transformació bidimensional de semblança oficial de l&#8217;ICC, <cite>EPSG:5166</cite>.</li>
<li><strong>Malla NTv2 ICC</strong>: La transformació de malla NTv2 oficial de l&#8217;ICC,  <cite>100800401.gsb</cite>.</li>
<li><strong>Malla NTv2 IGN</strong>: Darrera versió de la transformació de malla <cite>SPED2ETV2.gsb</cite> per a Península i Balears.</li>
<li><strong>7 paràmetres</strong>: La transformació de 7 paràmetres escollida automàticament per GeoServer abans d&#8217;aquest desenvolupament.</li>
<li><strong>Sense transformació</strong>: Distàncies obtingudes en cas de no aplicar cap transformació de datum.</li>
</ul>
<p>Els resultats mostren la mitjana i desviació estàndard obtingudes de calcular la distància entre cada un dels 959 parells de punts:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="31%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mètode</th>
<th class="head">distància mitjana</th>
<th class="head">desviació estàndard</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Semblança</td>
<td>3.9 mm</td>
<td>1.4 mm</td>
</tr>
<tr class="row-odd"><td>Malla NTv2 ICC</td>
<td>3.9 mm</td>
<td>1.4 mm</td>
</tr>
<tr class="row-even"><td>Malla NTv2 IGN</td>
<td>37.7 cm</td>
<td>1.9 cm</td>
</tr>
<tr class="row-odd"><td>7 paràmetres</td>
<td>4.353 m</td>
<td>8 mm</td>
</tr>
<tr class="row-even"><td>Sense transformació</td>
<td>102.038 m</td>
<td>3.4 cm</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Noteu que l&#8217;eix vertical de la figura s&#8217;expressa en escala logarítmica, degut a les grans variacions depenent del mètode aplicat. Tingueu present també que aquestes xifres són les obtingudes per al full indicat, i estrictament no són extrapolables a tot Catalunya.</p>
<div class="figure align-center">
<img alt="_images/posicio.png" src="_images/posicio.png" />
<p class="caption">Discrepància mitjana en la posició entre els mètodes aplicats per GeoTools i la referència de l&#8217;ICC.</p>
</div>
<p>S&#8217;observa que les dues alternatives proporcionades per l&#8217;ICC (malla i semblança) són perfectament equiparables. Com cabria esperar, donen els mateixos resultats estadístics. Existeix una discrepància posicional del voltant dels 4 mm respecte la referència, un ordre de magnitud per sota de l&#8217;error associat a la pròpia transformació, i per tant, assumible.</p>
<p>També s&#8217;ha volgut valorar l&#8217;exactitud de la malla NTv2 publicada per l&#8217;IGN. Observem en aquest cas una discrepància mitjana d&#8217;uns 40 cm. Per tant, no aconsellable per a cartografies d&#8217;escales més grans a 1:5 000.</p>
<p>La transformació de 7 paràmetres utilizada per GeoServer abans d&#8217;incorporar els nous mètodes aquí descrits resultava en un error d&#8217;uns 4 metres. Per tant, la incorporació de les transformacions oficials ha reduït l&#8217;error de transformació en tres ordres de magnitud respecte al comportament anterior de GeoServer.</p>
<p>Per últim, s&#8217;ha mesurat l&#8217;error comès en no aplicar cap canvi de datum, que, com és ben sabut, és de l&#8217;ordre dels 100 metres.</p>
</div>
<div class="section" id="tests-d-integracio">
<h2>Tests d&#8217;integració<a class="headerlink" href="#tests-d-integracio" title="Link permanent a aquest títol">¶</a></h2>
<p>Les proves anteriors s&#8217;han realitzat amb GeoTools. Per completar el joc de proves, cal verificar que aquest comportament també es dóna a GeoServer. s&#8217;ha realitzat una petita aplicació integrant en un mateix visor web:</p>
<ul class="simple">
<li>El servei WMS de Catastro.</li>
<li>El servei WMS de l&#8217;ICC (en concret, la capa <cite>mt5m</cite> de <cite>shagrat</cite>).</li>
<li>Capes publicades a GeoServer sense reprojecció.</li>
<li>Capes publicades a GeoServer reprojectades al vol utilitzant tant la transformació de semblança com la transformació de malla.</li>
</ul>
<p>S&#8217;han publicat doncs a GeoServer quatre capes WMS, a partir de quatre <em>shapefiles</em> descarregats directament de l&#8217;ICC: Es tracta de les dues capes (de punts i de línies) utilitzades en les proves anteriors, en els dos sistemes de referència (EPSG:23031, i EPSG:25831).</p>
<div class="figure align-center">
<img alt="_images/geoserver-layers.png" src="_images/geoserver-layers.png" />
<p class="caption">Capes publicades a GeoServer.</p>
</div>
<p>S&#8217;ha creat un visor web basat en OpenLayers, amb les capes de Catastro i de <cite>shagrat</cite> com a base, i les capes provinents de GeoServer superposades amb transparència. El visor web està referit a EPSG:25831, i realitzarà totes les peticions WMS en aquest CRS. El servei WMS de GeoServer reprojectarà al vol els shapefiles originalment en EPSG:23031.</p>
<p>S&#8217;han simbolitzat les capes en ED50 en color groc, amb una línia d&#8217;un píxel de gruix, o un punt quadrat de 2 píxels de costat. I les capes en ETRS89 s&#8217;han simbolitzat en color verd, amb un gruix de 3 píxels per a les línies, i un símbol quadrat de 4 píxels de costat per als punts. Així, solapant les capes reprojectades sobre les no reprojectades, l&#8217;efecte visual serà un farcit groc sobre un marc verd d&#8217;un píxel de gruix.</p>
<div class="figure align-center">
<img alt="_images/ol_25831.png" src="_images/ol_25831.png" />
<p class="caption">Prova funcional d&#8217;integració amb el servei WMS GeoServer (en EPSG:25831).</p>
</div>
<p>Observem que a l&#8217;escala 1:5 000 hi ha coincidència entre la imatge de <cite>shagrat</cite> i les de GeoServer. Observem també que tant la capa no reprojectada (en verd) com la capa reprojectada per GeoServer (en groc) coincideixen exctament, de manera que les geometries grogues apareixen perfectament emmarcades per les geometries verdes.</p>
<p>Per tant, podem assegurar que, a resulucions de 50 cm/píxel, els resultats entre una capa reprojectada ED50 =&gt; ETRS89 i una capa nativa en ETRS89 són indistingibles. Per apreciar discrepàncies visuals d&#8217;aproximadament un píxel, hem de realitzar peticions WMS amb una resolució al voltant dels 5 mm/píxel, en coherèhcia amb les proves de precisió realitzades (veure <a class="reference internal" href="#tests-de-precisio">Tests de precisió</a>).</p>
<p>Amb el visor anterior, la reprojecció es realitza utilitzant la transformació de semblança. Per comprovar que els resultats també es mantenen utilitzant la transformació de malla, s&#8217;ha desenvolupat un visor idèntic a l&#8217;anterior, però utilitzant EPSG:4258 com a CRS de visualització. GeoServer, en haver de generar una imatge en coordenades geodèsiques, utilitza la transformació de malla. Observem que els resultats són equivalents.</p>
<div class="figure align-center">
<img alt="_images/ol_4258.png" src="_images/ol_4258.png" />
<p class="caption">Prova funcional d&#8217;integració amb el servei WMS GeoServer (en EPSG:4258).</p>
</div>
<p>El codi JavaScript del visor OpenLayers és el següent:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">map</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">bounds</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">(</span>
        <span class="mf">428673.85</span><span class="p">,</span> <span class="mf">4580911.92</span><span class="p">,</span>
        <span class="mf">432179.44</span><span class="p">,</span> <span class="mf">4583258.19</span>
    <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">projection</span><span class="o">:</span> <span class="s2">&quot;EPSG:25831&quot;</span><span class="p">,</span>
        <span class="nx">maxExtent</span><span class="o">:</span> <span class="nx">bounds</span><span class="p">,</span>
        <span class="nx">units</span><span class="o">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
        <span class="nx">maxResolution</span><span class="o">:</span> <span class="mi">25</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">shagrat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">WMS</span><span class="p">(</span>
        <span class="s2">&quot;Shagrat mtc5m&quot;</span><span class="p">,</span>
        <span class="s2">&quot;http://shagrat.icc.es/lizardtech/iserv/ows?&quot;</span><span class="p">,</span>
        <span class="p">{</span>
           <span class="nx">layers</span><span class="o">:</span> <span class="s1">&#39;mtc5m,&#39;</span><span class="p">,</span>
           <span class="nx">styles</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="nx">srs</span><span class="o">:</span> <span class="s1">&#39;EPSG:25831&#39;</span><span class="p">,</span>
           <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
           <span class="nx">transparent</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;opacity&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;isBaseLayer&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">catastro</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">WMS</span><span class="p">(</span>
        <span class="s2">&quot;Catastro&quot;</span><span class="p">,</span>
        <span class="s2">&quot;http://www1.sedecatastro.gob.es/Cartografia/WMS/ServidorWMS.aspx?&quot;</span><span class="p">,</span>
        <span class="p">{</span>
           <span class="nx">layers</span><span class="o">:</span> <span class="s1">&#39;Catastro&#39;</span><span class="p">,</span>
           <span class="nx">styles</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="nx">srs</span><span class="o">:</span> <span class="s1">&#39;EPSG:25831&#39;</span><span class="p">,</span>
           <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;image/gif&#39;</span><span class="p">,</span>
           <span class="nx">transparent</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;opacity&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;isBaseLayer&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">singleTile</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">gs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">WMS</span><span class="p">(</span>
        <span class="s2">&quot;ED50 =&gt; ETRS89&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/geoserver/wms&quot;</span><span class="p">,</span>
        <span class="p">{</span>
           <span class="nx">layers</span><span class="o">:</span> <span class="s1">&#39;icc:linies_ED50,icc:punts_ED50&#39;</span><span class="p">,</span>
           <span class="nx">styles</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="nx">srs</span><span class="o">:</span> <span class="s1">&#39;EPSG:25831&#39;</span><span class="p">,</span>
           <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span>
           <span class="nx">transparent</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;opacity&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;isBaseLayer&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">singleTile</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">);</span>

    <span class="kd">var</span> <span class="nx">gs2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Layer</span><span class="p">.</span><span class="nx">WMS</span><span class="p">(</span>
        <span class="s2">&quot;Referència en ETRS89&quot;</span><span class="p">,</span>
        <span class="s2">&quot;/geoserver/wms&quot;</span><span class="p">,</span>
        <span class="p">{</span>
           <span class="nx">layers</span><span class="o">:</span> <span class="s1">&#39;icc:linies_ETRS89,icc:punts_ETRS89&#39;</span><span class="p">,</span>
           <span class="nx">styles</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="nx">srs</span><span class="o">:</span> <span class="s1">&#39;EPSG:25831&#39;</span><span class="p">,</span>
           <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span>
           <span class="nx">transparent</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;opacity&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;isBaseLayer&#39;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">singleTile</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
    <span class="p">);</span>

    <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">addLayers</span><span class="p">([</span><span class="nx">catastro</span><span class="p">,</span> <span class="nx">shagrat</span><span class="p">,</span> <span class="nx">gs</span><span class="p">,</span> <span class="nx">gs2</span><span class="p">]);</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">LayerSwitcher</span><span class="p">());</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">OpenLayers</span><span class="p">.</span><span class="nx">Control</span><span class="p">.</span><span class="nx">MousePosition</span><span class="p">());</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">zoomToExtent</span><span class="p">(</span><span class="nx">bounds</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Taula de Contingut</a></h3>
  <ul>
<li><a class="reference internal" href="#">Conjunt de proves realitzades</a><ul>
<li><a class="reference internal" href="#tests-unitaris">Tests unitaris</a></li>
<li><a class="reference internal" href="#tests-de-rendiment">Tests de rendiment</a></li>
<li><a class="reference internal" href="#tests-de-precisio">Tests de precisió</a></li>
<li><a class="reference internal" href="#tests-d-integracio">Tests d&#8217;integració</a></li>
</ul>
</li>
</ul>

  <h4>Tema anterior</h4>
  <p class="topless"><a href="geoserver.html"
                        title="capítol anterior">Desenvolupament a GeoServer</a></p>
  <h4>Tema següent</h4>
  <p class="topless"><a href="use.html"
                        title="capítol següent">Guia ràpida de configuració a GeoServer</a></p>
<div id="searchbox" style="display: none">
  <h3>Cerca ràpida</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Ves a" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Entra paraules de cerca o el nom d'un mòdul, classe o funció.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navegació</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="use.html" title="Guia ràpida de configuració a GeoServer"
             >següent</a></li>
        <li class="right" >
          <a href="geoserver.html" title="Desenvolupament a GeoServer"
             >anterior</a> |</li>
        <li><a href="index.html">Incorporació de transformacions de malla NTv2 a Geotools i a Geoserver 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Oscar Fonts.
      Creat amb <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>